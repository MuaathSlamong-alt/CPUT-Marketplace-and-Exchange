<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Post Product — CPUT Marketplace</title>
  <link rel="stylesheet" href="home/homestyle.css">
  <style>
    .form input, .form select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }
    
    .form input:focus, .form select:focus {
      outline: none;
      border-color: #3498db;
    }
    
    .form input[type="file"] {
      padding: 8px;
      background: #f9f9f9;
    }
    
    @media (max-width: 768px) {
      .featured-product {
        padding: 16px;
      }
      
      .form {
        max-width: 100% !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="img/CPUTLogo.jpg" alt="CPUT Marketplace Logo" class="logo-img">
    </div>
    <h1 class="header-title">CPUT Marketplace and Exchange</h1>
    <div class="header-icons">
  <img src="img/messenger_2111573.png" alt="Message" class="header-icon" id="messengerIcon">
      <img src="img/time_16601413.png" alt="Notifications" class="header-icon">
      <img src="img/user_9190837.png" alt="User" class="header-icon">
    </div>
  </header>

  <div class="main-container">
    <aside class="sidebar" aria-label="Sidebar navigation">
      <div class="search-container">
        <input type="search" id="sidebarSearchInput" class="search-input" placeholder="Search products by name..." style="flex:1;" />
        <button id="sidebarSearchButton" class="menu-item" style="margin-left:10px;">Search</button>
      </div>
      <div style="margin:12px 0;">
        <a href="product.html" style="display:flex;align-items:center;text-decoration:none;padding:10px;background:#f4f4f4;border-radius:8px;">
          <img src="img/post_17678551.png" alt="Post" style="width:28px;height:28px;margin-right:8px;"> 
          <span>Post product</span>
        </a>
      </div>
      <button class="menu-item" onclick="globalThis.location.href='home/home.html'">Back to Home</button>
      <button class="menu-item" onclick="globalThis.location.href='chat/chat.html'">Chat</button>
      <button class="menu-item" onclick="globalThis.location.href='search/search.html'">Search</button>
      <button class="review-us-btn" onclick="globalThis.location.href='rating/rating.html'">
        <span class="review-us-text">Review us</span>
        <img src="img/review_707675.png" alt="" class="review-icon">
      </button>
    </aside>
            <main class="content-area">
              <h2 class="section-title">Add a New Product</h2>
              <div class="featured-product" style="box-shadow:none; margin-bottom:20px;">
                <form class="form" id="productForm" method="POST" action="/products" enctype="multipart/form-data" style="width:100%;max-width:400px;margin:0 auto;">
                  <input name="name" placeholder="Product name" required style="margin-bottom:12px;" />
                  <input name="price" placeholder="Price" required style="margin-bottom:12px;" />
                  <select name="categoryId" required style="margin-bottom:12px;padding:8px;border:1px solid #ddd;border-radius:4px;width:100%;">
                    <option value="">Select a category</option>
                  </select>
                  <input type="file" name="image" accept="image/*" required style="margin-bottom:18px;" />
                  <button type="submit" class="menu-item" style="width:100%;margin-top:8px;">Post product</button>
                </form>
              </div>
            </main>
          </div>
          <footer>
            <div class="copyright">© CPUT Marketplace. All rights reserved.</div>
          </footer>
          <script>
            // Load categories on page load
            document.addEventListener('DOMContentLoaded', async () => {
              const API_BASE = globalThis.__API_BASE__ || '';
              try {
                const res = await fetch(API_BASE + '/categories');
                const categories = await res.json();
                const select = document.querySelector('select[name="categoryId"]');
                categories.forEach(cat => {
                  const option = document.createElement('option');
                  option.value = cat.id;
                  option.textContent = cat.name;
                  select.appendChild(option);
                });
              } catch (e) {
                console.error('Failed to load categories:', e);
              }
            });

            document.getElementById('productForm').addEventListener('submit', async (e)=>{
              e.preventDefault();
              
              // Check if user is logged in first
              const API_BASE = globalThis.__API_BASE__ || '';
              const authCheck = await fetch(API_BASE + '/api/me');
              if (!authCheck.ok) {
                alert('You must be logged in to post products. Redirecting to login page...');
                globalThis.location.href = 'login/login.html';
                return;
              }
              
              const form = e.target;
              const data = new FormData(form);
              const res = await fetch(API_BASE + '/products', { method: 'POST', body: data });
              const text = await res.text();
              alert(text);
              if (res.ok) globalThis.location.href = 'home/home.html';
            });
            document.getElementById('messengerIcon').onclick = function() {
              globalThis.location.href = 'chat/chat.html';
            };
            
            document.querySelector('img[alt="Notifications"]').onclick = function() {
              globalThis.location.href = 'notifications.html';
            };
            
            document.querySelector('img[alt="User"]').onclick = function() {
              globalThis.location.href = 'login/login.html';
            };
          </script>
        </body>
        </html>
