<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CPUT Marketplace Chat</title>
  <link rel="stylesheet" href="chatstyle.css">
  <script src="/socket.io/socket.io.js"></script>
  <script src="chat.js" defer></script>
</head>
<body>
  <header>
    <div class="logo">
      <img src="../img/CPUTLogo.jpg" alt="CPUT Marketplace Logo" class="logo-img">
    </div>
    <h1 class="header-title">CPUT Marketplace and Exchange</h1>
    <div class="header-icons">
  <img src="../img/messenger_2111573.png" alt="Message" class="header-icon" id="messengerIcon">
      <img src="../img/time_16601413.png" alt="Notifications" class="header-icon">
      <img src="../img/user_9190837.png" alt="User" class="header-icon">
    </div>
  </header>
  <div class="main-container">
    <aside class="sidebar" aria-label="Sidebar navigation">
      <div class="search-container">
        <a href="../search/search.html" style="display:flex;align-items:center;text-decoration:none;">
          <img src="../img/search_16705149.png" alt="Search" class="search-icon">
          <div class="search-text">Search</div>
        </a>
      </div>
      <div style="margin:12px 0;">
        <a href="../product.html" style="display:flex;align-items:center;text-decoration:none;padding:10px;background:#f4f4f4;border-radius:8px;">
          <img src="../img/post_17678551.png" alt="Post" style="width:28px;height:28px;margin-right:8px;"> 
          <span>Post product</span>
        </a>
      </div>
      <button class="menu-item" onclick="globalThis.location.href='../home/home.html'">Back to Home</button>
      <button class="menu-item" onclick="globalThis.location.href='../chat/chat.html'">Chat</button>
      <button class="menu-item" onclick="globalThis.location.href='../search/search.html'">Search</button>
      <button class="review-us-btn" onclick="globalThis.location.href='../rating/rating.html'">
        <span class="review-us-text">Review us</span>
        <img src="../img/review_707675.png" alt="" class="review-icon">
      </button>
    </aside>
    <main class="content-area">
      <h2 class="section-title">Chats</h2>
      <div class="chat-flex-row" style="display: flex; gap: 24px;">
        <div class="chat-userlist-panel" style="min-width:220px;max-width:260px;">
          <ul id="user-list">
            <!-- User list will be loaded dynamically -->
          </ul>
        </div>
        <div class="chat-window-panel" style="flex:1;">
          <div class="chat-header" id="chat-header">
            <!-- Chat header will be loaded dynamically -->
          </div>
          <button id="reportUserBtn" class="menu-item" style="margin-bottom:12px;float:right;">Report User</button>
          <div class="chat-messages" id="chat-messages">
            <!-- Messages will be loaded dynamically -->
          </div>
          <div class="chat-input">
            <input type="text" id="message-input" placeholder="Type a message...">
            <button id="send-btn">Send</button>
          </div>
        </div>
      </div>
    </main>
  </div>
  <footer>
    <div class="copyright">Â© CPUT Marketplace. All rights reserved.</div>
  </footer>
  <script>
    document.getElementById('messengerIcon').onclick = function() {
      globalThis.location.href = '../chat/chat.html';
    };
    // Report user button logic
    document.getElementById('reportUserBtn').onclick = function() {
      // If a user is selected, pass their info to the report page
      const chatHeader = document.getElementById('chat-header');
      const username = chatHeader && chatHeader.textContent ? chatHeader.textContent.trim() : '';
      // You can pass username as a query param, or just open the report page
      if (username) {
        globalThis.location.href = `../report/report.html?user=${encodeURIComponent(username)}`;
      } else {
        globalThis.location.href = '../report/report.html';
      }
    };
  </script>
</body>
</html>
